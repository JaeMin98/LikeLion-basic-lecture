## ë°°í¬í•˜ê¸°

### ğŸ”¸ ë°°í¬ ì‚¬ì „ì¤€ë¹„
#### keypoint : í™˜ê²½ ë³€ìˆ˜, requirements.txt, AWS

#### í™˜ê²½ ë³€ìˆ˜
- ì‹œìŠ¤í…œì— ì €ì¥ë˜ì–´ ìˆëŠ” ë³€ìˆ˜
-  ë³´í†µ ë¹„ë°€í‚¤ ë“± ìœ ì¶œë˜ë©´ ì•ˆë˜ëŠ” ì •ë³´
-  ë˜ëŠ” í™˜ê²½ì— ì°¨ì´ë¥¼ ë‘˜ ë•Œ ì‚¬ìš©
-  os.environì—ì„œ ë”•ì…”ë„ˆë¦¬ í˜•ì‹ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŒ
-  os.environ.get("ë³€ìˆ˜ëª…","ê¸°ë³¸ê°’")ìœ¼ë¡œ ì‚¬ìš©

#### requirements
-  ë‚´ íŒŒì´ì¬(ì¥ê³ ) ì•±ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ìš°ì„  ì„¤ì¹˜ë˜ì–´ì•¼ í•˜ëŠ” íŒ¨í‚¤ì§€ë“¤
-  Django,Pilow ë“±
-  íŒ¨í‚¤ì§€ëª…==ë²„ì „ìœ¼ë¡œ ì €ì¥
-  ë³´í†µrequirements.txtíŒŒì¼ì— ì €ì¥
-  pip freeze ëª…ë ¹ì–´ëŠ” í•´ë‹¹ í™˜ê²½ì— ì„¤ì¹˜ëœ ëª¨ë“  íŒ¨í‚¤ì§€ë¥¼ ë³´ì—¬ì¤Œ
-  ```>```ëŠ” í”„ë¡œê·¸ë¨ì˜ ì¶œë ¥ì„ íŒŒì¼ì— ì €ì¥í•œë‹¤ëŠ” ëœ»
-  ``` pip freeze > requirements.txt ```ë¡œ ìƒì„±

#### IAM (AWS)
-  Identity and Access Managementì˜ ì¤„ì¸ë§
-  IAMì—ì„œ ê³„ì •ì„ ë§Œë“  í›„ í•´ë‹¹ ê³„ì • ë¡œê·¸ì¸ ì •ë³´(ì—‘ì„¸ìŠ¤í‚¤ & ì‹œí¬ë¦¿ í‚¤)ë¥¼ ì´ìš©í•˜ì—¬ AWSì˜ APIí™œìš©
-  ë³´ì•ˆì„ ìœ„í•´ ê¶Œí•œì„ ìµœëŒ€í•œ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡ìŒ

#### S3 (AWS)
-  Simple Storage Serviceì˜ ì¤„ì¸ë§
-  AWSì—ì„œ ì œê³µí•˜ëŠ” êµ¬ê¸€ë“œë¼ì´ë¸Œì •ë„ë¡œ ìƒê°í•  ìˆ˜ ìˆìŒ
-  ìµœì†Œ ìš©ëŸ‰ ì§€ì • ì—†ì´ ì‚¬ìš©í•œ ë§Œí¼ë§Œ ê³¼ê¸ˆë˜ë¯€ë¡œ ìš©ëŸ‰ ì˜ˆì¸¡ í•„ìš” X
-  ì—¬ëŸ¬ ì„œë²„ì—ì„œ ë™ì‹œì— ì ‘ì† ê°€ëŠ¥(ë¶€í•˜ ë¶„ì‚° ìœ ë¦¬)



### ğŸ”¸ Heroku ë°°í¬í•˜ê¸°
-  1.Heroku íšŒì›ê°€ì…

-  2.Heroku CLI ì„¤ì¹˜

- 3.í™˜ê²½ë³€ìˆ˜ì ìš©
```
1.Debug ëŠ” ì•„ë˜ ê°’ ì‚¬ìš© 
1.DEBUG = (os.environ.get('DEBUG', 'True') != 'False')
```

- 4.gitignore íŒŒì¼ ì ìš©
```
1. gitignore.io ì—ì„œ Django ì„ íƒ í›„ 'ìƒì„±' í´ë¦­ 
2. í˜ì´ì§€ì— ë‚˜ì˜¨ í…ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ë³µì‚¬ í›„ .gitignore íŒŒì¼ë¡œ ì €ì¥
```
- 5.Heroku ìš© íŒŒì¼ ì‘ì„±
```
1. Procfileì´ë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ì–´ ì•„ë˜ ë‚´ìš© ì‘ì„± (ëŒ€ë¬¸ìë¡œ í•´ì•¼í•¨/manage.pyê°€ ìˆëŠ” í´ë” ì•ˆì— ë§Œë“¤ê¸°)
    1-1.web: gunicorn í”„ë¡œì íŠ¸ëª….wsgi --log-file-
2.runtime.txt íŒŒì¼ì— ì•„ë˜ ë‚´ìš© ì‘ì„±
â€‹   2-1. python-3.9.1
```

- 6.í•„ìš”í•œ Dependencyì„¤ì¹˜
```
1.pip install gunicorn whitenoise dj-database-url psycopg2-binary
```

- 7.settings.py ìˆ˜ì •
```
1. Whitenoise ì„¤ì¹˜
    1. MIDDLEWAREì—ì„œ ì œì¼ SecurityMiddleware ë°”ë¡œ ì•„ë˜ ë‚´ìš© ì¶”ê°€
       	1. 'whitenoise.middleware.WhiteNoiseMiddleware'.
 	2. ALLOWED-HOSTSìˆ˜ì •
     	1. ALLOWED_HOSTS = [] ë¥¼ ALLOWED_HOSTS = ['*']ë¡œ ìˆ˜ì •
 	3. DBê´€ë ¨ ì½”ë“œ ìˆ˜ì •
     	1. settings.py ì œì¼ ë°‘ì— ì•„ë˜ ë‚´ìš© ì¶”ê°€
```



### ğŸ”¸ DOCKER ì´ë¯¸ì§€ ìƒì„±
#### 1.ì¤€ë¹„ ì‚¬í•­
```
1.Gitpod.io ê³„ì • (Free or Student)
    1.GitpodFree ëŠ” í¼ë¸”ë¦­ ë ˆí¬ë§Œ ì‘ì—… ê°€ëŠ¥ /ì›” 50ì‹œê°„ ì œí•œ
    2.Gitpod StudentëŠ” í”„ë¼ì´ë¹— ë ˆí¬ë„ ì‘ì—… ê°€ëŠ¥ /ì›” 100ì‹œê°„ ì œí•œ
        1.Gitpod StudnetëŠ” í•™ìƒ ì¸ì¦ëœ gitgub ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ í›„ my subscription í˜ì´ì§€ì—ì„œ í™•ì¸ ê°€ëŠ¥
```
- 2.Gitpod ì„¤ì • ìˆ˜ì •
```
1.Gitpod > Settings
    1.Feature Preview > Enable Feature Preview ì²´í¬
    2.Default IDE ì„ íƒ
        1.Theia : Eclipse íŒ€ì´ ë§Œë“  IDE / ê°•ì˜ì—ì„œ ì‚¬ìš©
        2.Code : VSCode ì˜ ì›¹ë²„ì „ IDE / í˜¸í™˜ì„± ì´ìŠˆ ìˆìŒ
```
- 3.Gitpod ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
```
1.ë³¸ì¸ì˜ GitHub ë ˆí¬ì§€í† ë¦¬ë¡œ ì´ë™
2.ë ˆí¬ì§€í† ë¦¬ ì£¼ì†Œ ì•ì— gitpod.io/
3.ì˜ˆ) gitpod.io/#https://github.com/username/repo
```
- 4.DockerHub ê³„ì •ìƒì„±

#### 2.requirements ì„¤ì¹˜
```
1.pip install -r requirements.txt
```
#### 3.Whitenoise ì„¤ì¹˜
```
1.pip install whitenoise
2.MIDDLEWARE ì—ì„œ SecurityMiddleware ë°”ë¡œ ì•„ë˜ ë‚´ìš© ì¶”ê°€
    1.'whitenoise.middleware.WhiteNoiseMiddleware'
```
#### 4.Gunicorn ì„¤ì¹˜
```
1.pip install gunicorn
```
#### 5.Dockerfile ìƒì„±
```
FROM python:3.8
ENV PYTHONUNBUFFERED=1
RUN mkdir /app
WORKDIR /app
COPY . /app
RUN apt-get update \
	&& apt-get install -y \
	python3 python3-pip python3-dev python3-venv build-essential libpq-dev \
	&& rm -rf/var/lib/apt/lists/*
RUN pip install -r requirements.txt
RUN chmod +x /app/run.sh
EXPOSE 8000

ENTRYPOINT ["/app/run.sh"]
```
##### 1.run.shíŒŒì¼ ìƒì„±
```
#!/bin/bash --> bashë¥¼ ì´ìš©í•´ì„œ ì‹¤í–‰ì‹œí‚¤ê² ë‹¤, ë¬´ì‹œí•´ë„ë¨

python manage.py migrate

python manage.py collectstatic

gunicorn lionproject.wsgi b.0.0.0.0:8000
```
```
1.pip freeze > requirements.txt #requirement íŒŒì¼ ìƒì„±
2.sudo docker-up #ì´ ì°½ì„ ë‹«ìœ¼ì‹œë©´ ì•ˆë©ë‹ˆë‹¤
3.Ctrl + Shift + ` í‚¤ë¡œ ìƒˆë¡œìš´ í„°ë¯¸ë„ ì—´ê¸°
4.docker build -t DockerHubld/django-app . #ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
5.docker run -it -p 8000:8000 DockerHubld/django-app #ìƒì„±ëœ ë„ì»¤ ì´ë¯¸ì§€ ì‹¤í–‰
6.docker login #Docker Hubì— ë¡œê·¸ì¸(ì´ë¯¸ì§€ ì—…ë¡œë“œìš©)
7.docker push DockerHubld/django-app #Docker Hubì— ìƒì„±ëœ ì´ë¯¸ì§€ ì—…ë¡œë“œ
8.https://hub.docker.com/r/DockerHubld/django-app ì—ì„œ ë‚´ì•±ì´ ì—…ë¡œë“œëœ ê²ƒì„ í™•ì¸
```



### ğŸ”¸ DOCKER ì„œë²„ì— ë°°í¬í•˜ê¸°
- 1.ì¤€ë¹„ ì‚¬í•­
```
1.EC2 ì¸ìŠ¤í„´ìŠ¤ (AWS EC2 ì „ë°˜ë¶€ ì°¸ê³ )
2.Docker Hubì— ë“±ë¡ëœ ì´ë¯¸ì§€
```
- 2.ì„œë²„ ì„¸íŒ…
```
1.Docker ì„¤ì¹˜
    curl -fsSL https://get.docker.com| bash
2.Docker Compose ì„¤ì¹˜
    sudo curl -L "https://github.com/docker/compose/releases/download/1.28.5/docker-compose-$(uname -s)-$(uname -m)"
    sudo chmod +x /usr/local/bin/docker-compose
3.ì•± ì„¤ì¹˜ í´ë” ì§€ì •
    sudo mkdir /opt/django-app
    cd/opt/django-app
4.docker-compose.yml ìƒì„±
    vi docker -compose.yml
    .env íŒŒì¼ ìƒì„±
```
- 3.DB ìµœì´ˆ ì‹¤í–‰ (db ìƒì„±, ì‚¬ìš©ì ë“±ë¡ ë“± ì§„í–‰)
```
sudo docker -compose up db
```
- 4.ì˜ ì‘ë™ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
```
1.sudo docker -compose up
2.ë‚´IP:8000 ì ‘ì† ë˜ëŠ”ì§€ í™•ì¸
```
- 5.ë°±ê·¸ë¼ìš´ë“œ ëª¨ë“œë¡œ ì „í™©
```
sudo docker -compose up -d
```



### ğŸ”¸ DOCKER ì´ë¯¸ì§€ ìë™ ìƒì„±(Github Action)
- 1.ì¤€ë¹„ì‚¬í•­
```
1.Dockerë¡œ ë°°í¬í•˜ê¸°ê°€ ëë‚œ ë ˆí¬
2.GitHub ê³„ì •
```
- 2.GitHubì˜ ë‚´ ë ˆí¬ë¡œ ì´ë™
- 3.Actions ë²„íŠ¼ ì„ íƒ
```
1.Setup a workflow yourself ì„ íƒ
```
- 4.ì´ë¦„ì„ docker-publish.ymlë¡œ ì„¤ì •í›„ ì•„ë˜ ë‚´ìš© ì‘ì„±